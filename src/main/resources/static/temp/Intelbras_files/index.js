function checkMimeType(a){for(var b=navigator.mimeTypes,c=[],d=0;d<b.length;d++)if(c.push(b[d].type),a.contains(b[d].type))return!0;return!1}function getRemoteParams(){var a=window.location.href,b=a.split(/[?]/);if(b.length>=2){remoteParams.ALL=b[1];var c=b[1].split("&"),d=[];c.each(function(a){d.extend(a.split("="))});for(var e=0;e<d.length;e++)switch(d[e]){case"username":remoteParams.uName=d[++e];break;case"password":remoteParams.pwd=d[++e];break;case"ccid":remoteParams.ccid=d[++e];break;case"t2uip":remoteParams.t2uip=d[++e];break;case"t2uport":remoteParams.t2uport=d[++e];break;case"p2pport":remoteParams.t2utcpport=d[++e];break;case"ddnshost":remoteParams.ddnshost=d[++e];break;case"devwebport":remoteParams.devwebPort=d[++e];break;case"from":remoteParams.from=d[++e]}("remote"==remoteParams.from||void 0!=remoteParams.uName&&void 0!=remoteParams.pwd)&&(g_isRemoteLogin=!0)}}function loadAllCssFile(){var a="";g_isRemoteLogin&&(a="?"+remoteParams.ALL);for(var b=["/css/reset.css","/css/ui.css","/css/fn.css","/css/skin.css","/css/index.css","/css/playbackindex.css","/css/oem.css"],c=0;c<b.length;c++)loadCssFile(b[c]+a,function(){})}function getDeviceType(){g_deviceType=Ability.deviceAllTypeList.g_deviceType,g_deviceSubType=Ability.deviceAllTypeList.g_deviceSubType}function initFrames(){g_frames.preview=window.frame_preview,g_frames.alarm=window.frame_alarm,g_frames.setup=window.frame_set,g_frames.info=window.frame_info,g_frames.face=window.frame_face}function showLogin(){$("m").style.top="-10000px"}function refreshSessionID(){rpcCore.sessionID=Cookie.read("DhWebClientSessionID"),g_frames.preview&&(g_frames.preview.rpcCore=rpcCore),g_frames.playback&&(g_frames.playback.rpcCore=rpcCore),g_frames.alarm&&(g_frames.alarm.rpcCore=rpcCore),g_frames.setup&&(g_frames.setup.rpcCore=rpcCore),g_frames.info&&(g_frames.info.rpcCore=rpcCore),g_frames.face&&(g_frames.face.rpcCore=rpcCore)}function cancelWeakPasswordTip(){var a={Enable:!1},b=ConfigManager.instance();b.setConfig(["SecurityWarn"],[a])}function showSecurityTips(){if((new MagicBox).getProductDef(["UserNameLimit","PassWordLimit","GroupNameLimit","SupportWeakPassword"],function(a,b){if(b.result&&"array"===$type(b.params)){var c=b.params;c[0].result&&c[0].params&&(g_userNameLimit=c[0].params.definition),c[1].result&&c[1].params&&(g_passWordLimit=c[1].params.definition),c[2].result&&c[2].params&&(g_groupNameLimit=c[2].params.definition),c[3].result&&c[3].params&&(g_supportWeakPassword=c[3].params.definition)}},!1),"admin"!=$("username").value||g_isRemoteLogin)return void loginFinish();var a=!1,b=function(b,c){var d=c.params;d[0].result&&(a=d[0].params.table.Enable)},c=ConfigManager.instance();if(c.getConfig(["SecurityWarn"],b,!1),a){var d=tl("conf_account.tips_tipsinfo_IB");d=d.replace(/\n/gi,"<br>"),$("modadmin_security_tipsinfo").set("html",d),$("modadmin_newPassword").value="",$("modadmin_confirmPassword").value="",$("modadmin_oldPassword").value="";var e=!0;if(e&&(g_modadminpwdLevel=new mUI.Level("modadminPasswordLevel"),g_modadminpwdLevel.show()),attachMutiTypeInputLimit("modadmin_oldPassword",16),attachMaxCharLength("modadmin_oldPassword","modadmin_remark",g_passWordLimit[1]),limitMaxCharLength($("modadmin_oldPassword"),"modadmin_remark",g_passWordLimit[1],!0),attachMutiTypeInputLimit("modadmin_newPassword",16),attachMaxCharLength("modadmin_newPassword","modadmin_remark",g_passWordLimit[1]),limitMaxCharLength($("modadmin_newPassword"),"modadmin_remark",g_passWordLimit[1],!0),attachMutiTypeInputLimit("modadmin_confirmPassword",16),attachMaxCharLength("modadmin_confirmPassword","modadmin_remark",g_passWordLimit[1]),limitMaxCharLength($("modadmin_confirmPassword"),"modadmin_remark",g_passWordLimit[1],!0),e&&$("modadmin_newPassword").addEvent("keyup",function(){var a=$("modadmin_newPassword").value,b=getPwdLevel(a);g_modadminpwdLevel.show(b)}),dlgModAdminPassword=new Dialog("dlg_ModAdminPassword",admin_change,"btn_admin_change","btn_admin_skip",tl("conf_account.change_admin_password")),dlgNerverShowModAdminPassword=new Dialog("dlg_weakPassword",nerver_show_yes,"btn_weakPassword_yes","btn_weakPassword_cancel",tl("comstring.commessage")),dlgEmptyPasswordWarn=new Dialog("dlg_emptyPassword",emptyPassword_yes,"btn_emptyPassword_yes","btn_emptyPassword_cancel",tl("comstring.commessage")),jsonWebCaps.b_supportAdmin)return void alert(tl("ugm_msg.account_first_login_tips"));dlgModAdminPassword.setPosition(400,0),dlgNerverShowModAdminPassword.setPosition(400,80),dlgEmptyPasswordWarn.setPosition(400,80),dlgModAdminPassword.show().addEvent("close",admin_skip),jsonWebCaps.b_compelPassword?($("oldPwdLabel").style.display="none",$("modadmin_oldPassword").style.display="none",$("btn_admin_skip").style.display="none",$("newPwdLabel").setProperty("text",tl("conf_account.setpwd")),$("modadmin_newPassword").focus()):$("modadmin_oldPassword").focus(),dlgNerverShowModAdminPassword.addEvent("close",nerver_show_cancel)}else loginFinish()}function change_admin_password(){var a=function(a,b){if(b.result)cancelWeakPasswordTip(),dlgModAdminPassword.hide(),loginFinish();else{var c=0,d=function(a,b){b.result&&(c=b.params.error),8==c?remarkDisplay("modadmin_remark",tl("conf.LoginErrorNo-1"),3e3,1):remarkDisplay("modadmin_remark",tl("com_msg.Operateingfailure"),3e3,1)},e=new RPCCall,f=e.getRequest("userManager.getErrorNo",'""');sendRequest(f,d)}},b=$("modadmin_newPassword").value,c=$("modadmin_oldPassword").value;jsonWebCaps.b_compelPassword&&(c=$("password").value),UserManager.instance().modifyPwd("admin",b,c,a),jsonWebCaps.DockUser&&jsonWebCaps.DockUser.contains("Onvif")&&DockUser.instance().modifyPasswordByType("Onvif","admin",b,c)}function admin_change(){var a=$("modadmin_newPassword").value;a!=$("modadmin_confirmPassword").value?remarkDisplay("modadmin_remark",tl("ugm_msg.passwd_not_match"),3e3,1):a==$("password").value?remarkDisplay("modadmin_remark",tl("ugm_msg.old_new_same"),3e3,1):a.length<g_passWordLimit[0]?remarkDisplay("modadmin_remark",tl("com_msg.PasswdLenNotValid")+" "+g_passWordLimit[0]+"-"+g_passWordLimit[1],3e3,1):g_modadminpwdLevel&&"low"===g_modadminpwdLevel.getLevel()&&!g_supportWeakPassword?remarkDisplay("modadmin_remark",tl("ugm_msg.pwd_is_simple"),3e3,1):""==a?dlgEmptyPasswordWarn.show():change_admin_password()}function admin_skip(){$("weakPassword_enable").checked=!1,dlgNerverShowModAdminPassword.show()}function nerver_show_yes(){$("weakPassword_enable").checked&&cancelWeakPasswordTip(),dlgNerverShowModAdminPassword.hide(),loginFinish()}function nerver_show_cancel(){$("modadmin_newPassword").value="",$("modadmin_confirmPassword").value="",$("modadmin_oldPassword").value="",dlgModAdminPassword.show()}function emptyPassword_yes(){dlgEmptyPasswordWarn.close(),change_admin_password()}function login(){if(!g_previewLoaded)return void login.delay(100);if(g_forNacl)return void alert(tl("com_msg.needChromeApp"));if(!hasPlugin)return void alert(Sys.npapi?tl("com_msg.needActivex"):tl("com_msg.needActivex")+" "+tl("comstring_npapitps"));var a=$("username").value,b=$("password").value,c=!1,d=0;$("net_wan").checked&&(d=1),g_netType=d;var e=jsonWebCaps.loginType.length<=1?jsonWebCaps.loginType[0]||0:$("s_lgType").value-0;if("usernameEncrypt"==jsonWebCaps.encryptType){var f={Protocol:"PluginAbility",Params:{encryption:"usernameEncrypt"}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(f))}var g=jsonWebCaps.SetReduceNoiseMode||2,h={Protocol:"SetReduceNoiseMode",Params:{mode:g}};if(g_ocx.ProtocolPluginWithWebCall(JSON.encode(h)),jsonWebCaps.vendor&&g_ocx.SetOEM(jsonWebCaps.vendor),jsonWebCaps.b_supportCloud&&"Daf2$B"==a)return void alert(tl("conf.LoginErrorNo-2"));if(c=g_isRemoteLogin?g_frames.preview.loginOCX(a,b,d,e,remoteParams.ccid,remoteParams.t2uip,remoteParams.t2uport,remoteParams.t2utcpport):g_frames.preview.loginOCX(a,b,d,e)){if("888888"===a||"666666"==a)return alert(tl("comstring.accessdenied")),void doWithLoginFailure();var i=parent.jsonWebCaps.encryptType;""!=i&&void 0!=i&&(a=window[i](a)),g_autoPassword=b,Global.instance().login(a,b,function(){Ability.getEncryptInfo(),showSecurityTips(),beginKeepAlive()},!0,function(a){switch(a&&a.error&&a.error.code){case 268632070:alert(tl("conf.LoginErrorNo-2"));break;case 268632071:alert(tl("conf.LoginErrorNo-1"));break;case 268632073:alert(tl("conf.LoginErrorNo-6"));break;case 268632074:alert(tl("conf.LoginErrorNo-4"));break;case 268632075:alert(tl("opr_ocx.the number of connection is maximal.request is refused!"));break;default:alert(tl("com_msg.Login failure!"))}doWithLoginFailure()})}else doWithLoginFailure()}function showTime(){var a=window.setInterval(function(){$("xtt").set("text",(new Date).toStringFormat("hh:mm:ss"))},1e3);$.subscribe("logout",function(){clearInterval(a)})}function loginFinish(){var a=$("username").value,b=$("password").value;if(Ability.initial(),$("b_f").style.display=Ability.ivsCaps.scene.contains("FaceDetection")?"":"none",g_basePassword=Base64.encode(a+":"+b),getDeviceType(),refreshSessionID(),getCurAuthorityList(),changeNavStyle($("xyl")),g_frames.preview.pageInit(),getDiskPnts(),jsonWebCaps.checkUpgrade&&checkUpgradeState(),hasPlugin){var c=g_ocx.GetLoginID();settings.loginid=c}if(settings.pswd="",g_ocx&&g_ocx.SetModuleMode(0==g_netType?1:10),Ability.ivsCaps.support){var d=ConfigManager.instance();d.getConfig("GUISet",function(a,b){if(b.result){var c=b.params.table,d=c[0].IntelliRuleShowEnable;g_ocx.SetIVSEnable(d?!0:!1)}})}setTimeout(function(){changeOcxMode("Preview")},0),document.title=tl("com_menu.PREVIEW_TITLE"),$("l").style.display="none",$("m").style.top="0px",showIframe("f_preview"),resize(),g_frames.preview.multiPreview.setMultiPreviewVideoOut(),settings.username=a,savesetting(),checkIsSDIDev(),$("password").value="",checkReplayAuth(),g_isRemoteLogin&&loadPlayAndAlarmPage.delay(0),setOCXGUIConfig()}function doWithLoginFailure(){$("password").value="",$("password").focus(),g_isRemoteLogin&&showLogin()}function initLangSelect(){var a=new MagicBox,b=function(a){for(var b=JSON.decode(a).params.definition,c="",d=0;d<b.length;d++)c+=b[d]==curLang?'<a href="javascript:;" class="J_current" data-lang="'+b[d]+'">'+tl(b[d])+"</a>":'<a href="javascript:;" data-lang="'+b[d]+'">'+tl(b[d])+"</a>";$("language_list").innerHTML=c,$$("#select_language .J_select_center").set("text",tl(curLang)),$$("#language_list a").addEvent("click",function(){$$("#language_list a").removeClass("J_current"),this.addClass("J_current"),$("language_list").style.display="none",reTranslate(this.getProperty("data-lang"))})};a.getProductDef("Languages",b)}function reTranslate(a){if(curLang!=a){curLang=a;var b="/custom_lang/"+a+".txt",c="/web_lang/"+a+".txt";switch(getLangFile(b,c),$$("#select_language .J_select_center").set("text",tl(curLang)),g_pageID){case 0:document.title=tl("com_menu.PREVIEW_TITLE");break;case 1:document.title=tl("com_menu.PLAYBACK_TITLE");break;case 2:document.title=tl("com_menu.CONFIG_TITLE");break;case 3:document.title=tl("com_menu.ALARM_TITLE");break;case 4:document.title=tl("titles.info");break;default:document.title=tl("WEB SERVICE")}g_frames.preview.getJsonlang(),g_frames.preview.inilanguage(),g_frames.alarm.getlang(),g_frames.alarm.initlanguage(),$("frame_set").src.contains("setindex.htm")&&(g_frames.setup.getlang(),g_frames.setup.inilanguage(),g_frames.setup.initLang()),$("frames_info").src.contains("infoindex.htm")&&(g_frames.info.getlang(),g_frames.infoinilanguage(),g_frames.info.initLang())}}function chk10(a){var b=a-0;return 10>a-0?"0"+(b-0):b}function checkIsSDIDev(){var a=function(a,b){var c=b.result;if(c){var d=b.params.caps.SetColor;g_isSDIDev=d?0:1,Ability.dynamicResolution=b.params.caps.DynamicResolution||!1}},b=new DevVideoOut;b.instance(0,function(c,d){var e=1;d.result&&(e=d.result),b.getCaps(e,a)})}function checkReplayAuth(){$("b_ab").style.display="none";for(var a=0;a<g_frames.preview.CHANNEL_NUMBER;a++)if(checkAuthority("Replay_"+chk10(a+1))||checkAuthority("Replay")&&g_deviceSubType.contains("EVS")){$("b_ab").style.display="";break}""!=$("b_f").style.display||checkAuthority("Replay_01")||($("b_f").style.display="none")}function changeNavStyle(a){$("nav_head").getElements("a").each(function(a){a.removeClass("main-nav-item-current")}),"d_alarmtip"==a.id?$("xbjsz").addClass("main-nav-item-current"):a.addClass("main-nav-item-current")}function showPreviewPage(){if(dFlag&&($clear(g_timerdcs),dFlag=0),0!=g_pageID){if(1!=g_pageID&&6!=g_pageID||!hasPlugin||stopPlayBack(),g_frames.preview.refreshChNameList(),g_frames.preview.multiPreview.showAndGetMultiPreview(),document.title=tl("com_menu.PREVIEW_TITLE"),g_ocx&&g_ocx.SetModuleMode(0==g_netType?1:10),Ability.ivsCaps.support){var a=ConfigManager.instance();a.getConfig("GUISet",function(a,b){if(b.result){var c=b.params.table,d=c[0].IntelliRuleShowEnable;g_ocx.SetIVSEnable(d?!0:!1)}})}g_ocx&&g_ocx.PlayStopSound(),showIframe("f_preview"),changeOcxMode("Preview"),resize(),(2==g_pageID||1==g_pageID||3==g_pageID||4==g_pageID||6==g_pageID)&&(g_pageID=0,stopSetVideo(),g_frames.preview.g_closeAll&&g_frames.preview.resumePlay()),g_pageID=0,g_frames.preview.refreshAlarmChn(),g_frames.preview.getRecordState(),g_frames.preview.fisheyeDisplay(!1),setOCXGUIConfig()}}function setOCXGUIConfig(){ConfigManager.instance().getConfig("GUISet",function(a,b){if(b.result){var c={Protocol:"PlayByOrignalScale",Params:{Enable:"Original"==b.params.table[0].OutputMode}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(c))}})}function showPlaybackPage(){if(dFlag&&($clear(g_timerdcs),dFlag=0),!hasPlugin)return void showPluginSetup();if(1!=g_pageID){if(!g_playAndAlarmLoad)return;if(0==g_playLoadState)return void loadPlaybackHtml();g_frames.preview.closeAllVideos(),6==g_pageID&&stopPlayBack(),document.title=tl("com_menu.PLAYBACK_TITLE"),g_pageID=1,showIframe("f_playback"),$("play_page_playback").style.top="0px",$("play_page_downmore").style.display="none",$("playback_lockSearch_div").setStyle("display","none"),$("play_page_tagmanager").setStyle("display","none"),g_ocx&&g_ocx.SetModuleMode(4),Ability.ivsCaps.support&&g_ocx.SetIVSEnable(!0),1==g_playLoadState?(PlayBack.showCalendarToday(),changeOcxMode("Hidden"),changeOcxMode("Playback"),resize(),setTimeout(function(){1==g_pageID&&(PlayBack.init(),resize(),g_playLoadState=2)},0)):2==g_playLoadState?(changeOcxMode("Playback"),PlayBack.render(),resize(),PlayBack.resumeWindBinded(),PlayBack.AddRecordInfoByChannel(),Ability.g_SupportedScene.contains("FaceDetection")&&(PlayBack.messageHandler.changeMonth(),setTimeout("PlayBack.messageHandler.fileListChanged()",500))):(changeOcxMode("Playback"),PlayBack.init(),resize(),g_playLoadState=2),PlayBack.play2Show(),PlayBack.IsNeedShowSyncPlay(),g_deviceSubType.contains("EVS")&&PlayBack.initChnlNameSelect(),setOCXGUIConfig()}}function showAlarmPage(){if(dFlag&&($clear(g_timerdcs),dFlag=0),3!=g_pageID){if(!g_playAndAlarmLoad)return;1!=g_pageID&&6!=g_pageID||!hasPlugin||stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("com_menu.ALARM_TITLE"),g_pageID=3,changeOcxMode("Hidden"),showIframe("f_alarm"),hiddenTip(),stopSetVideo();var a=g_frames.alarm.comet;if(0==g_alarmed){if(g_frames.alarm.rpcCore=rpcCore,Ability.notifyVersion)devNotify.subscribe("client.notifyEventStream",g_frames.alarm.receiveMessage);else{var b="/cgi-bin/eventManager.cgi?action=notifyEventStream&sessionId="+rpcCore.sessionID;a.setSrc(b)}var c,d,e=ChannelNumInfo.instance();c=e.getAlarmIN(),d=e.getAlarmOUT(),0==c&&0==d&&(g_frames.alarm.$("showAlarmType_5").style.display="none"),g_deviceSubType.contains("EVS")?(g_deviceSubType.contains("EVS7")&&(g_frames.alarm.$("showAlarmType_8").setStyle("display","block"),g_frames.alarm.$("showAlarmType_13").setStyle("display","block")),g_frames.alarm.$("showAlarmType_6").style.display="",g_frames.alarm.$("showAlarmType_7").style.display="",g_frames.alarm.$("showAlarmType_9").setStyle("display","block")):(g_frames.alarm.$("showAlarmType_6").style.display="none",g_frames.alarm.$("showAlarmType_7").style.display="none"),Ability.ivsCaps.support&&g_frames.alarm.$("showAlarmType_10").setStyle("display","block"),Ability.audioDetect.support&&g_frames.alarm.$("showAlarmType_11").setStyle("display","block"),Ability.b_supportDiskCheck&&(g_frames.alarm.$("showAlarmType_12").style.display=""),g_alarmed=1}}}function showTip(){$("d_alarmtip").style.display=""}function hiddenTip(){$("d_alarmtip").style.display="none"}function showSetupPage(){2!=g_pageID&&((1==g_pageID||6==g_pageID)&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("com_menu.CONFIG_TITLE"),g_pageID=2,changeOcxMode("Hidden"),showIframe("f_setup"),$("frame_set").src.contains("setindex.htm")?setTimeout("startSetVideo()",0):$("frame_set").src="html/setindex.htm?"+remoteParams.ALL)}function showFacePlayBackPage(){6!=g_pageID&&(document.title=tl("com_title.facesearch"),1==g_pageID&&stopPlayBack(),g_pageID=6,showIframe("f_faceplay"),changeNavStyle($("facePlayback")),g_frames.preview.closeAllVideos(),g_ocx&&g_ocx.SetModuleMode(4),changeOcxMode("FacePlayBack"),g_ocx.SetSelPlayer(0),g_ocx.SetWinBindedChannelEx(1,0,JSON.encode({channels:[0]}),"channels"),$("frame_face").src.contains("faceplayback.htm")?(g_ocx.SetModuleMode(4),setTimeout(function(){g_frames.face.faceplayback.render()},100)):$("frame_face").src="html/faceplayback.htm",resize())}function cancelUpgrade(){var a=RemoteUpgrader.instance();a.cancel(function(){})}function showPage(a){var b=window.event;!b&&null!=showPage.caller&&showPage.caller.arguments[0]&&(b=showPage.caller.arguments[0]);var c=b.target||b.srcElement;Global.instance().keepAlive(300,!1,function(){switch(changeNavStyle($(c)),a){case"preview":showPreviewPage();break;case"playback":showPlaybackPage();break;case"faceplayback":showFacePlayBackPage();break;case"alarm":showAlarmPage();break;case"setup":showSetupPage();break;case"sysinfo":showInfoPage()}},function(){alert(tl("com_msg.ConnectionOvertime"))})}function showInfoPage(){dFlag&&($clear(g_timerdcs),dFlag=0),4!=g_pageID&&((1==g_pageID||6==g_pageID)&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("titles.info"),g_pageID=4,changeOcxMode("Hidden"),showIframe("f_info"),$("frame_info").src.contains("infoindex.htm")||($("frame_info").src="html/infoindex.htm?"+remoteParams.ALL))}function showIframe(a){$("f_preview").style.top="-10000px",$("f_playback").style.top="-10000px",$("f_alarm").style.top="-10000px",$("f_setup").style.top="-10000px",$("f_info").style.top="-10000px",$("f_faceplay").style.top="-10000px",$(a).style.top="69px"}function webLogout(){return devNotify.unSubscribe(),g_stateUpgrading?void alert(tl("com_msg.UpgradingForbidExitWeb")):(g_stateIPCUpdate&&(cancelUpgrade(),g_stateIPCUpdate=!1),1==g_pageID&&stopPlayBack(),document.title=tl("WEB SERVICE"),showLogin(),$("l").style.display="",g_alarmed=0,void 0!=g_frames.preview.g_authorityListPtz&&(g_frames.preview.g_authorityListPtz=[]),hiddenTip(),g_frames.alarm.nochkType(),g_frames.preview.closePreScrn(),Sys.ie?("Camera"==g_mode&&hasPlugin&&g_ocx.StopPreview(),PlayBack.goLogout(),g_frames.preview.goLogout(),hasPlugin&&g_ocx.PlayStopSound()):hasPlugin&&("Preview"==g_mode&&(g_ocx.ControlTalking(0),g_ocx.PlayStopSound(),g_ocx.DisConnectAllChannel()),PlayBack.goLogout(),g_ocx.LogoutDevice()),doLogout(),void resetAllStatus())}function exit2LoginPage(){return g_isRemoteLogin?void webLogout():g_stateUpgrading?void alert(tl("com_msg.UpgradingForbidExitWeb")):(g_stateIPCUpdate&&(cancelUpgrade(),g_stateIPCUpdate=!1),document.title=tl("WEB SERVICE"),$("m").style.top="-10000px",$("l").style.display="",g_alarmed=0,hiddenTip(),g_frames.alarm.nochkType(),g_frames.preview.goLogout(),void resetAllStatus())}function resetAllStatus(){loadJavaScript("/js/playbackindex.js",function(){}),loadJavaScript("/js/appAbility.js",function(){}),loadPlaybackHtml.delay(0),$("frame_set").src="",$("frame_info").src="",showIframe("f_preview"),null!=g_frames.preview.g_channel_in&&g_frames.preview.g_channel_in.setStyle("marginTop",0),g_pageID=0,g_playLoadState=3,dFlag=0,$.publish("restart")}function startSetVideo(){var a=null!=g_frames.setup.document.getElementById("CAMERA"),b=null!=g_frames.setup.document.getElementById("page_ipcIntellentNewConfig");a&&(g_ocx&&g_ocx.SetModuleMode(9),changeOcxMode("Camera"),g_frames.setup.Openrealstream()),b&&g_frames.setup.Page.ipcIntellentNewConfig._goThisPage()}function stopSetVideo(){hasPlugin&&g_ocx.StopPreview()}function stopPlayBack(){try{{g_ocx.CloseAllNetPlayback()}}catch(a){console.log(a)}}function tl(a){return jsonLang&&jsonLang[a]?jsonLang[a].trim():a}function savesetting(){HashCookie.extend(settings)}function getsetting(){settings.username=HashCookie.get("username")?HashCookie.get("username"):"",settings.pswd="",settings.talktype=HashCookie.get("talktype")?HashCookie.get("talktype"):"1",settings.logintype=HashCookie.get("logintype")?HashCookie.get("logintype"):"0",settings.openall=HashCookie.get("openall")?HashCookie.get("openall"):"2",$("username").setProperty("value",settings.username),$("password").setProperty("value",settings.pswd)}function resize(){resizeVideo(),resizeVideo()}function resizeVideo(){var a=caculateFrameWH();if(0!==a[2]){var b=a[0],c=a[1];if(parseInt($("f_preview").getStyle("height"))!=c+10||b-2!=parseInt($("f_preview").getStyle("width")))switch(Sys.ie?($("f_preview").setStyle("width",b-4),$("f_preview").setStyle("height",c+10),$("f_alarm").setStyle("width",b-2),$("f_alarm").setStyle("height",c),$("f_setup").setStyle("width",b-4),$("f_setup").setStyle("height",c),$("nav_head").setStyle("width",b-4),$("f_info").setStyle("width",b-4),$("f_info").setStyle("height",c),$("f_faceplay").setStyle("width",b-4),$("f_faceplay").setStyle("height",c),$("m").setStyle("height",c.toInt()>680?c+85:c)):($("f_preview").setStyle("width",b-6),$("f_preview").setStyle("height",c+10),$("f_alarm").setStyle("width",b-2),$("f_alarm").setStyle("height",c),$("f_setup").setStyle("width",b),$("f_setup").setStyle("height",c),$("nav_head").setStyle("width",b),$("f_info").setStyle("width",b-6),$("f_info").setStyle("height",c+10),$("f_faceplay").setStyle("width",b),$("f_faceplay").setStyle("height",c)),g_mode){case"Preview":g_previewLoaded&&(g_frames.preview.adjustVideoSize(b-2,c),changeOcxStyle({width:b-320,height:c-36-49}));break;case"Playback":a=caculatePlayFrameWH(),b=a[0],c=a[1],adjustPlayback(b,c-3),changeOcxStyle({width:b-234,height:$("playback_right").getHeight()});break;case"FacePlayBack":var d=$("f_faceplay").getWidth();changeOcxStyle({left:.67*d,width:.33*d})}}}function adjustPlayback(a,b){var c=a-220,d=b-208;(d!=parseInt($("div_showPlayOcx").getStyle("height"))+1||c!=parseInt($("div_showPlayOcx").getStyle("width")))&&($("J_pb_topleft").setStyle("height",d+40),$("J_pb_topleft").setStyle("width",c),$("play_page_playback").setStyle("width",a-5),$("div_showPlayOcx").setStyle("height",d+30),$("rogatoryFileListBox").setStyle("height",d-255),$("div_showPlayOcx").setStyle("width",c),$("playback_right").setStyle("height",d),$("gridTotalLength").setStyle("width",a-40),$("play2_sa").setStyle("width",a-40),$("play_axesOcx").setStyle("width",a-35),PlayBack.ajustScrollBar(a-70))}function caculateFrameWH(){var a=document.documentElement.clientWidth,b=document.documentElement.clientHeight,c=89,d=a>1140?a:1140,e=b-c;return e=800>e?800:e,[d,e,a]}function caculatePlayFrameWH(){var a=document.documentElement.clientWidth,b=document.documentElement.clientHeight,c=56,d=a>1140?a:1140,e=b-c;return e=680>e?680:e,[d,e]}function onPageIndexReady(){if($("index_logo").testBackgroundImage("/custom_logo/loginlogo.jpg"),$("sub_logo").testBackgroundImage("/custom_logo/logo.jpg"),g_forNacl)return void alert(tl("com_msg.needChromeApp"));if(hasPlugin||showPluginSetup(),g_isRemoteLogin){var a=location.protocol+"//"+top.window.location.host+"/webplugin.exe";$("login_btn_install").href=a}$("l").translation(),$("m").translation(),setPlayAndAlarmPage(),initFrames(),getsetting(),showPreviewOCX(hasPlugin),g_pageID=0,hasPlugin&&(""!=$("username").value?g_isRemoteLogin||$("password").focus():g_isRemoteLogin||$("username").focus()),$("ul_ltype").style.display=isMac||$defined(jsonWebCaps.loginType)&&jsonWebCaps.loginType.length<=1?"none":"";var b=jsonWebCaps.demand;"foxconn"==b&&($("username").maxLength=25,$("password").maxLength=25),$("login_btn_cancel").addEvent("click",function(){$("login_install_dialog").style.display="none"}),$("login_btn_install").addEvent("click",function(){$("login_install_dialog").style.display="none",reLoadPlugin(),"function"==typeof reloadPageAtloadedPluing&&reloadPageAtloadedPluing()}),g_isRemoteLogin?($("username").value=remoteParams.uName,$("password").value=remoteParams.pwd,hasPlugin?login():($("l").style.display="",autoLoginWeb.delay(5e3))):loadPlayAndAlarmPage()}function setPlayAndAlarmPage(){$("frame_alarm").src="html/alarmindex.htm?"+(g_isRemoteLogin?"?"+remoteParams.ALL:""),loadJavaScript("/js/Calendar.js",function(){}),loadJavaScript("/js/PlayControl.js",function(){}),loadJavaScript("/js/FileList.js",function(){}),loadJavaScript("/js/WindowManager.js",function(){}),loadJavaScript("/js/Grid.js",function(){}),loadJavaScript("/js/GroupControl.js",function(){}),loadJavaScript("/js/publicFunc.js",function(){}),loadJavaScript("/js/playbackindex.js",function(){loadPlaybackHtml.delay(0)}),g_playAndAlarmLoad=!0}function autoLoginWeb(){checkPlugins()&&hasPlugin?login.delay(1e3):autoLoginWeb.delay(1e3)}function loadPlaybackHtml(){loadHtmlFile("../html/playbackindex.htm?"+remoteParams.ALL,function(a){$("f_playback").set("html",a).translation(),loadOcxAxes();var b=caculateFrameWH();$("play_page_playback").setStyle("width",b[0]),g_playLoadState=1},$empty)}function loadOcxAxes(){"undefined"==typeof TIMEAXES_MAINTYPE&&(TIMEAXES_MAINTYPE=PLUGINS_MAINTYPE),"undefined"==typeof TIMEAXES_CLASSID&&(TIMEAXES_CLASSID=PLUGINS_CLASSID);var a="";a=Sys.ie?"<object id='timeaxes' width='100%' height='100%' classid='CLSID:{classid}'><param name='nActiveType' value=0></object>".substitute({classid:TIMEAXES_CLASSID}):'<object id="timeaxes" width="100%" height="100%" type="{axesType}" nActiveType="0"></object>'.substitute({axesType:TIMEAXES_MAINTYPE}),$("play_axesOcx")&&hasPlugin?$("play_axesOcx").innerHTML=a:loadOcxAxes.delay(1e3)}function initPageOcx(){g_bNewPlugin?g_ocx.initialize():g_ocx=$("ocx"),g_frames.preview.ocx=g_ocx,getConfigPath.delay(50),setConfigPath.delay(2e3),bindOcxEvents()}function onPageLoaded(){g_previewLoaded=!0,g_isRemoteLogin||(showLoading(!1),g_isRemoteLogin||showLogin())}function showLoading(a){if(Sys.ie){var b=a?"block":"none";$("loading").style.display=b,$("lab_loading").style.display=b}}function setFrameHeight(a){$("frame_preview").setStyle("height",a+50)}function getCurAuthorityList(){var a=$("username").value,b=function(a){g_authorityList=JSON.decode(a).params.user.AuthorityList},c=UserManager.instance();c.getUserInfo(a,b,!1)}function checkAuthority(a){return null==g_authorityList?void 0:a?g_authorityList.contains(a)?!0:!1:!0}function getDiskPnts(){var a=new StorageDVR,b=!0,c=function(c){b=JSON.decode(c).result;var d=[];if(b)if(JSON.decode(c).params&&(d=JSON.decode(c).params.list||[]),0==d.length){b=!1;var e=!1,f=ConfigManager.instance();f.getConfig("StorageGroup",function(a){if(JSON.decode(a).result)for(var b=getTable(a),c=0;c<b.length;c++)if($chk(b[c].Name)&&b[c].Name.contains("StoragePool")){e=!0;break}return e?void 0:void alert(tl("com_str.StorageNotExist"))})}else{b=!0;var g=!1,h=function(b){JSON.decode(b).result&&a.getInfo(JSON.decode(b).result,i)},i=function(a,b){b.result&&b.params.info.IsError&&!g&&(g=!0,alert(tl("conf_alarm.diskerror")))};d.each(function(b){a.instance(b,h)})}};a.getDirectoryPaths(c)}function checkUpgradeState(){var a=Upgrader.instance();a.check(function(a,b){if(b.result)switch(b.params.info.State){case"Regular":case"Emergency":alert(tl("upgrade.prompt"))}})}function getConfigPath(){var a=Cookie.read("DhWebSnapPath")||g_ocx&&g_ocx.GetConfigPath(1),b=Cookie.read("DhWebRecordPath")||g_ocx&&g_ocx.GetConfigPath(2);return a=tl(a),b=tl(b),Browser.Platform.win?(a=a||"C:\\PictureDownload",b=b||"C:\\RecordDownload"):(a=a||"/usr",b=b||"/usr"),Cookie.write("DhWebSnapPath",a,{duration:30,path:"/"}),Cookie.write("DhWebRecordPath",b,{duration:30,path:"/"}),[a,b]}function setConfigPath(){var a=Cookie.read("DhWebSnapPath")||g_ocx&&g_ocx.GetConfigPath(1),b=Cookie.read("DhWebRecordPath")||g_ocx&&g_ocx.GetConfigPath(2);a=tl(a),b=tl(b),Browser.Platform.win?(a=a||"C:\\PictureDownload",b=b||"C:\\RecordDownload"):(a=a||"/usr",b=b||"/usr"),g_ocx&&g_ocx.SetConfigPath(1,a),g_ocx&&g_ocx.SetConfigPath(2,b)}function loadPlayAndAlarmPage(){$("frame_alarm").src="html/alarmindex.htm?"+remoteParams.ALL,loadJavaScript("/js/Calendar.js",function(){}),loadJavaScript("/js/PlayControl.js",function(){}),loadJavaScript("/js/FileList.js",function(){}),loadJavaScript("/js/WindowManager.js",function(){}),loadJavaScript("/js/Grid.js",function(){}),loadJavaScript("/js/GroupControl.js",function(){}),loadJavaScript("/js/publicFunc.js",function(){}),loadJavaScript("/Component/chnlGroup.js",function(){}),loadJavaScript("/js/playbackindex.js",function(){loadPlaybackHtml.delay(0)}),g_playAndAlarmLoad=!0}function getPassword(){return $("password").value}var g_deviceType="DVR",g_deviceSubType="",Capability={tagEnable:function(){return"NVR"===g_deviceType?!0:!1},videoLockEnable:function(){return"NVR"===g_deviceType?!0:!1}},Sys={},isMac=-1!=navigator.userAgent.toLowerCase().indexOf("mac"),ua=navigator.userAgent.toLowerCase(),s;(s=ua.match(/(msie\s|trident.*rv:)([\d.]+)/))?Sys.ie=s[2]:(s=ua.match(/firefox\/([\d.]+)/))?Sys.firefox=s[1]:(s=ua.match(/chrome\/([\d.]+)/))?Sys.chrome=s[1]:(s=ua.match(/opera.([\d.]+)/))?Sys.opera=s[1]:(s=ua.match(/version\/([\d.]+).*safari/))?Sys.safari=s[1]:0,Sys.npapi=!(Sys.chrome&&Sys.chrome.split(".")[0]>=42);var g_haveqt=!1;if(navigator.plugins)for(var i=0;i<navigator.plugins.length;i++)navigator.plugins[i].name.indexOf("QuickTime")>=0&&(g_haveqt=!0);var g_forNacl=!1;if(void 0!=Sys.chrome&&null!=Sys.chrome&&Sys.chrome.length>0){var g_currBrowserVersion=0,g_minBrowserVersion=39,nIndex=Sys.chrome.indexOf(".");g_currBrowserVersion=nIndex>0?Sys.chrome.substring(0,nIndex).toInt():Sys.chrome.toInt(),g_currBrowserVersion>g_minBrowserVersion&&(checkMimeType(["video/mp4","application/x-vnd.google.update3webcontrol.3","application/x-vnd.google.oneclickctrl.9"])||(g_forNacl=!0))}var jsonLang,g_pageID=0,g_basePassword="",g_authorityList,g_alarmed=0,g_previewLoaded=!1,g_isSDIDev=0,g_stateUpgrading=!1,g_stateIPCUpdate=!1,HashCookie=new Hash.Cookie("DhWebCookie",{duration:30}),settings={username:"",pswd:"",talktype:"1",logintype:"0",openall:"2",loginid:""},g_frames={preview:"",playback:"",setup:"",alarm:"",info:"",face:""},g_bNewPlugin="D9CA2B5E-C180-4EB1-9E60-345C2956174D"==PLUGINS_CLASSID,g_ocx=0,g_mode="Preview",g_netType=0,g_playLoadState=0,dFlag=0,g_timerdcs=0,remoteParams={},g_playAndAlarmLoad=!1,g_userNameLimit=[1,6],g_passWordLimit=[0,6],g_groupNameLimit=[1,6],g_supportWeakPassword=!0;getRemoteParams(),loadAllCssFile();var curLang=getLangConf(),dlgModAdminPassword=null,dlgNerverShowModAdminPassword=null,dlgEmptyPasswordWarn=null,g_modadminpwdLevel=null;Sys.firefox||Sys.safari?window.addEvent("beforeunload",function(a){return g_ocx.ControlTalking(0),g_stateUpgrading?(alert(tl("com_msg.UpgradingForbidExitWeb")),void a.preventDefault()):(g_stateIPCUpdate&&(cancelUpgrade(),g_stateIPCUpdate=!1,a.preventDefault()),void doLogout())}):(window.addEvent("beforeunload",function(){var a=Sys.ie&&(event.clientY<0||event.altKey);return g_stateUpgrading&&a?(alert(tl("com_msg.UpgradingForbidExitWeb")),void(event.returnValue="")):void(g_stateIPCUpdate&&a&&(cancelUpgrade(),g_stateIPCUpdate=!1,event.returnValue=""))}),window.addEvent("unload",function(){Sys.ie&&hasPlugin&&g_ocx&&("Preview"==g_mode&&(g_ocx.ControlTalking(0),g_ocx.PlayStopSound(),g_ocx.DisConnectAllChannel()),PlayBack.goLogout(),g_ocx.LogoutDevice()),doLogout()})),window.addEvent("resize",function(){resize()});