function bindOcxEvents(){try{$("ocx").AddEventListener("TransEvent",handlerOcxEvents.fireOcxEvent),$("ocx").AddEventListener("SetNetPlayRecordStatus",handlerOcxEvents.fileStatus),$("ocx").AddEventListener("SetNetPlayFileInfo",handlerOcxEvents.playFileInfo),$("ocx").AddEventListener("NetPlayTimeInform",handlerOcxEvents.NetPlayTimeInform),$("ocx").AddEventListener("StateChanged",handlerOcxEvents.StateChanged),$("ocx").AddEventListener("InsertNetRecordFileInfo",handlerOcxEvents.InsertNetRecordFileInfo),$("ocx").AddEventListener("FileDialogInfo",handlerOcxEvents.FileDialogInfo),$("ocx").AddEventListener("OutPutStringInfo",handlerOcxEvents.OutPutStringInfo)}catch(a){bindOcxEvents.delay(500)}}function bindTimeaxesEvents(){try{$("timeaxes").AddEventListener("OnOpenNetPlayByTime",handlerOcxEvents.OnOpenNetPlayByTime),$("timeaxes").AddEventListener("BackUpBeginTimeChanged",handlerOcxEvents.BackUpBeginTimeChanged),$("timeaxes").AddEventListener("BackUpEndTimeChanged",handlerOcxEvents.BackUpEndTimeChanged)}catch(a){bindTimeaxesEvents.delay(500)}}function reConnect(a){function b(){$.publish("restart"),clearInterval(a)}var c=HashCookie.get("username"),d=parent.jsonWebCaps.encryptType;""!=d&&void 0!=d&&(c=window[d](c)),Global.instance().login(c,g_autoPassword,function(){parent.refreshSessionID(),parent.g_frames.alarm.alarmReConnect(),parent.g_frames.setup.autoReconnect&&parent.g_frames.setup.autoReconnect(),parent.g_frames.preview.autoReConnect(),b(),beginKeepAlive()})}function FireStateChangedEx(a,b,c,d){g_frames.preview.FireStateChangedEx(a,b,c,d)}function FireReturnWindInfo(a,b,c,d,e,f,g){g_frames.preview.FireReturnWindInfo(a,b,c,d,e,f,g)}function FireReturnPlayState(a){g_frames.preview.FireReturnPlayState(a)}var handlerOcxEvents={fireOcxEvent:function(a){var b=JSON.decode(a),c=[],d=0;for(var e in b.EventParam)c[d++]=b.EventParam[e];handlerOcxEvents[b.EventName]&&handlerOcxEvents[b.EventName](b.EventParam)},StateChanged:function(a,b,c,d){FireStateChangedEx(a,b,c,d)},BatchDownloadProcess:function(a){g_frames.face.faceplayback.processDL(a)},NetPlayTimeInform:function(a){"Playback"==g_mode?PlayBack&&PlayBack.SetNetPlayTime(a):"FacePlayBack"==g_mode&&g_frames.face.faceplayback&&g_frames.face.faceplayback.SetNetPlayTime(a)},ReturnLocalState:function(a){FireReturnPlayState(a)},ReturnWindInfo:function(a){"Playback"==g_mode?PlayBack&&PlayBack.setSelChannel&&PlayBack.setSelChannel(a.winID,a.channel):FireReturnWindInfo(a.winID,a.channel,a.state,a.ptz,a.fluency,a.quality,a.vertical),$chk(a.fisheyeinfo)&&"Preview"===g_mode&&g_frames.preview.showFishEye(a)},PTZPosition:function(a){var b=new Class({initialize:function(a,b){this.x=a,this.y=b}}),c=function(a,c){return new b(parseInt(8192*(a.x-c.x)*2/d),parseInt(8192*(a.y-c.y)*2/e))},d=a.winWidth-0,e=a.winHight-0,f=a.isReverse?1:-1,g=0,h=new b(a.selRegion.left-0,a.selRegion.top-0),i=new b(a.selRegion.right-0,a.selRegion.bottom-0),j=new b(d/2,e/2),k=new Object;if(h.x==i.x||h.y==i.y)g=0,k=c(i,j);else{g=f*Math.abs(d*e/((i.x-h.x)*(i.y-h.y))).round();var l=new b(Math.abs((i.x+h.x)/2).round(),Math.abs((i.y+h.y)/2).round());k=c(l,j)}g_frames.preview.controlPtz(!0,"Position",k.x,k.y,g)},DownloadByFilePos:function(a){var b=a.speed,c=a.pos,d=a.end;PlayBack.downLoadProgress(b,c,d)},fileStatus:function(a){1==g_pageID&&PlayBack.setDayHaveFile&&PlayBack&&PlayBack.setDayHaveFile(a),6==g_pageID&&g_frames.face.faceplayback&&g_frames.face.faceplayback.setDayHaveFile(a)},playFileInfo:function(a,b){1==g_pageID&&PlayBack&&PlayBack.parseFileInfo(a,b)},NetPlayState:function(a){1==g_pageID?PlayBack&&PlayBack.NetPlayState(a.winID,a.channel,a.open,a.speed,a.state,a.direction,a.isSwitchwin):a.channel>0&&PlayBack&&PlayBack.NetPlayState(a.winID,a.channel,a.open,a.speed,a.state,a.direction,a.isSwitchwin),6==g_pageID&&g_frames.face.faceplayback&&g_frames.face.faceplayback.NetPlayState(a.winID,a.channel,a.open,a.speed,a.state),$chk(a.fisheyeinfo)&&"Playback"===g_mode&&PlayBack&&PlayBack.showFishEye(a)},OnOpenNetPlayByTime:function(a,b){PlayBack&&PlayBack.PlayBackByTime(a,b)},DownloadByFilePos:function(a){PlayBack&&PlayBack.downLoadProgress(a.end,a.pos,a.speed,0,a.FileInfo)},DownloadByTimePos:function(a){PlayBack&&PlayBack.downLoadProgress(a.end,a.pos,a.speed,1)},BackUpBeginTimeChanged:function(a,b){PlayBack&&PlayBack.BackUpTimeChanged(a,b,0)},BackUpEndTimeChanged:function(a,b){PlayBack&&PlayBack.BackUpTimeChanged(a,b,1)},WaterMarkPos:function(a){0!=a.total&&DownMore.fireWaterMarkPos(a.pos/a.total,a.status)},WaterMarkInfo:function(a){DownMore.fireWaterMarkInfo(a.waterMark,a.errType,a.time)},QueryItemInfo:function(a){DownMore.fireRecNumInfo(a.LastItem,a.ItemTotal)},InsertNetRecordFileInfo:function(a,b,c){DownMore.fireNewRecordFileInfo(a,b,c)},FileDialogInfo:function(a,b){1==g_pageID?""!=a&&(""!=b?DownMore.fireDialogInfo(a,b):DownMore.changePathOcx(a)):3==g_pageID?g_frames.alarm.fireDialogInfo(a,b):4==g_pageID?g_frames.info.fireDialogInfo(a,b):6==g_pageID?g_frames.face.faceplayback.fireDialogInfo(a,b):g_frames.setup.fireDialogInfo(a,b)},WebPluginInfo:function(a){alert(a.Description)},BackupDeviceList:function(a){DownMore.BackupDeviceList(a)},RemoteBackupPos:function(a){DownMore.backupProgress(a.end,a.pos,a.speed)},DeviceDisConnected:function(){$.publish("disConnected")},AutoDeviceConnected:function(){var a={timer:1e3,maxtime:6e3},b=singInterval(reConnect,a.timer);setTimeout(function(){clearInterval(b)},a.maxtime)},OutPutStringInfo:function(a,b){var c=!0;c&&"OutPutShapeRect"==a&&g_frames.setup.Page.ipcIntellentNewConfig.Tab["public"].OutPutShapeRect(b),c&&"OutPutObjectRect"==a&&g_frames.setup.Page.ipcIntellentNewConfig.Tab["public"].setFilterValue(b)}};