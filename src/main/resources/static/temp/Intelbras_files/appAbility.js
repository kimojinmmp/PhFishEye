var Ability={deviceAllTypeList:{g_deviceType:"",g_deviceSubType:""},b_GB28181:!1,b_supportDiskCheck:!1,iscsi:{isSupportIscsi:!1,iscsiNum:8},playbackCompress:{enable:!1,splists:[],maxSplit:4},audioPlay:!1,playbyFrame:!1,playBackwards:!1,playbackSync:!1,isSupportMultiCardModes:!1,displayMode:!1,displaySpotOutMode:!1,alphaRange:!0,videoPal_NTSC:"PAL",packetLengthRange:[1,60],packetSizeRange:[1024,8192],b_SearchPrecise:!1,b_supportExtra1:!1,dynamicResolution:!1,maxExtra:1,com_485_Num:0,com_232_Num:0,g_videoChipType:"",isHDCVI:!1,supportAHDchn:!1,supportMixCapture:[],singnalType:[],maxAnalogChannel:0,EQParam:{isSupportEQ:!1,EQsupportchannel:[]},PositionParam:{isSupportVideoPosition:!1,videoSetsupportchannel:[],defaultPostion:0,positionRange:[]},isSupportNM:!1,coaxial:{alarmSupport:!1,alarmChnl:[]},logEnable:!1,RedundancyPowerNum:0,previewMode:"",previewSplitNumList:[],PoEEnable:!1,isNVR_N7:!1,isTwistedPairSet:!1,g_easySpaceEnable:!1,isSupportVolumeClone:!1,isSupportRaid:!1,isRedundant:!0,isResumeTransmit:!1,isTVadjust:!1,isDiskTank:!0,b_FtpUpload:!0,b_realtimeCompress:!1,b_historyCompress:!1,onvifVersion:"",isSupportPlaySnapshot:!1,g_SupportedScene:[],productVendor:"",audioFrequency:{support:!1,frequency:[]},productAbroadInfo:"",voicefilepath:"/",isSupportAdjustTime:!1,isSupportDualLive:!1,isSupportHTTPS:!1,isSupportAlarmBell:!1,AlarmOutLatch:[1,300],alarmUpload:!0,isDeviceDiscoveryPrivate:!0,SupportAnalogToDigital:!0,maxExtendChannels:0,CHANNEL_NUMBER:0,REMOTE_CHANNELS:0,ALARM_IN_NUMBER:-1,ALARM_OUT_NUMBER:-1,bUserTimeSet:!1,mainBoardCount:1,notifyVersion:0,Antidither:{support:!1,range:[0,300]},audioDetect:{support:!1,volumeDetect:{support:!1,channels:[]},anomalyDetect:{support:!1,channels:[]},mutationDetect:{support:!1,channels:[]}},ivsCaps:{intellectVideo:!1,support:!1,scene:[],rules:{},frontCaps:{support:!1,SupportedScene:[],rules:{}},backCaps:{support:!1,SupportedScene:[],rules:{}}},encryptInfo:{},maxStreams:1,b_supportRecordMode:!0,initial:function(){this.getProductDefinition(),this.getDeviceAllTypeList(),this.channelNum(),this.getEqAbility(),isMac||(this.playbyFrame=!0),("NVR"==this.deviceAllTypeList.g_deviceType&&!this.deviceAllTypeList.g_deviceSubType.contains("EVS")&&!isMac||this.deviceAllTypeList.g_deviceType.contains("DVR")&&!this.deviceAllTypeList.g_deviceSubType.contains("AMF"))&&(this.playBackwards=!0,this.playbackSync=!0),("NVR_N7"==this.deviceAllTypeList.g_deviceSubType||"NVR7200"==this.deviceAllTypeList.g_deviceSubType)&&(this.isNVR_N7=!0);var a=Speak.instance();a.getCaps(this.speakCaps.bind(this)),this.getNetAppCaps(),this.getVideoStandard(),this.videoChipType(),this.getVideoInputCaps(),this.getChCaptureChipCaps(),this.getCoaxialAlarm(),("NVR"==this.deviceAllTypeList.g_deviceType||"DVR"==this.deviceAllTypeList.g_deviceType||"HDVR"==this.deviceAllTypeList.g_deviceType)&&(this.logEnable=!0),this.getFaceBoardCaps(),this.dowithEncodeCaps(),this.getStoragecaps(),this.getdiskTank(),this.getVolumeCloneCap(),this.getDevOutCap(),this.getOnvifVerison(),this.getClustercaps(),this.getMainBoardCount(),this.getAudioDetectCaps(),this.isSupportIVS(),this.getEventHanderCap();var b=Backup.instance();b.getCaps(this.getBackupCaps.bind(this)),this.getNotifyVersion(),this.getRecordCap()},getEncryptInfo:function(){var a=EncryptSecurity.instance();a.getEncryptInfo(function(a,b){b.result&&(this.encryptInfo=b.params)}.bind(this))},getBackupCaps:function(a,b){b.result&&b.params&&b.params.caps&&(this.b_FtpUpload=b.params.caps.FtpUploadRecord)},getVolumeCloneCap:function(){this.isSupportVolumeClone=!1},speakCaps:function(a,b){b.params&&b.params.caps&&(this.audioPlay=b.params.caps.SupportAudioPlay||!1)},getPicBackupCap:function(){return"NVR"==this.deviceAllTypeList.g_deviceType?!1:!0},getRecordCtrlDefaultEnable:function(){return this.deviceAllTypeList.g_deviceSubType.contains("EVS")?!0:!1},mediaEcodeCaps:function(a,b){b.params&&(this.playbackCompress.splists=b.params.caps.PlaybackCompressSplitNumList||[],this.playbackCompress.enable=this.playbackCompress.splists.length>0?"0"==Cookie.read("DHloginType"):!1,this.playbackCompress.enable&&(this.playbackCompress.maxSplit=this.playbackCompress.splists[this.playbackCompress.splists.length-1]))},isSupportIVS:function(){if(isMac)return!1;var a=this.REMOTE_CHANNELS,b=this.CHANNEL_NUMBER-a,c=VideoInAnalyse.instance(),d=this,e=function(a,b,c){if(c.result){var e=c.params.caps;d.ivsCaps[a].support=!!e,e&&(d.ivsCaps[a].SupportedScene=e.SupportedScene||[],e.SupportedScene.each(function(b){d.ivsCaps[a].rules[b]=e.SupportedScenes[b].SupportedRules||{}}))}d.ivsCaps.support=d.ivsCaps.frontCaps.support|d.ivsCaps.backCaps.support,d.ivsCaps.scene=d.ivsCaps.frontCaps.SupportedScene.combine(d.ivsCaps.backCaps.SupportedScene),d.ivsCaps.rules=$merge(d.ivsCaps.frontCaps.rules,d.ivsCaps.backCaps.rules),d.ivsCaps.intellectVideo=d.ivsCaps.scene.contains("Normal")};0!==a&&c.getAnalyseCaps(b,function(a,b){e("frontCaps",a,b)}),b>0&&c.getAnalyseCaps(0,function(a,b){e("backCaps",a,b)},!1)},getVideoStandard:function(){var a=ConfigManager.instance();a.getConfig(["VideoStandard","SpecialDirectoryDefine"],function(a,b){if(b.result){var c=b.params;c[0].params&&c[0].params.table&&(this.videoPal_NTSC=c[0].params.table),c[1]&&c[1].params&&c[1].params.table&&(this.voicefilepath=c[1].params.table.EventVoiceDirectory||"/")}}.bind(this))},capAbility:function(){return(2&streamCap)>>1?(this.maxExtra=1,(4&streamCap)>>2&&this.maxExtra++,(8&streamCap)>>3&&this.maxExtra++):this.maxExtra=0,this.maxExtra},getEqAbility:function(){var a=MediaManage.instance(),b=["EQ","Margin","MaxAnalogChannel","TwistedPair"],c=function(a,b){b.result&&(b.params.caps&&b.params.caps.EQ&&(this.EQParam.isSupportEQ=b.params.caps.EQ.SupportReset,this.EQParam.EQsupportchannel=b.params.caps.EQ.Channels||[]),b.params.caps&&b.params.caps.Margin&&(this.PositionParam.isSupportVideoPosition=b.params.caps.Margin.Support,this.PositionParam.videoSetsupportchannel=b.params.caps.Margin.Channels||[],this.PositionParam.positionRange=b.params.caps.Margin.HorRange,this.PositionParam.defaultPostion=this.PositionParam.positionRange[1]/2),b.params.caps&&void 0!=b.params.caps.MaxAnalogChannel&&(this.maxAnalogChannel=b.params.caps.MaxAnalogChannel),b.params.caps&&b.params.caps.TwistedPair&&(this.isTwistedPairSet=b.params.caps.TwistedPair.Set))};a.getCaps(b,c.bind(Ability),!1)},videoChipType:function(){var a=function(a){var b=JSON.decode(a).result;if(b){var c=this.g_videoChipType=JSON.decode(a).params.type;this.isHDCVI="VIDEO_DH9901_720P"==c||"VIDEO_DH9901_1080P"==c||"VIDEO_DH9901_1080_TW2964_960"==c||"VIDEO_DH9901_1080_TW2968_960"==c||c.contains("VIDEO_DH9910_")||c.contains("VIDEO_DH9920")||"VIDEO_PR1000_720P"==c}},b=new MagicBox;b.getVideoChipType(a.bind(this),!0)},getCoaxialAlarm:function(){this.coaxial.alarmChnl=[],this.coaxial.alarmSupport=!!this.coaxial.alarmChnl.length;var a=Alarm.instance();a.getAlarmCaps(function(a,b){b.result&&b.params.caps&&(this.coaxial.alarmChnl=b.params.caps.CoaxialAlarmChannels||[],this.coaxial.alarmSupport=!!this.coaxial.alarmChnl.length,this.getCoaxialAlarmRes&&this.getCoaxialAlarmRes())}.bind(this),!1)},isSupportMultiPlay:function(){return this.deviceAllTypeList.g_deviceSubType.contains("EVS")?!0:!1},getFaceBoardCaps:function(){var a=FaceBorad.instance();a.getCaps(function(a,b){b.result&&b.params.caps&&(this.RedundancyPowerNum=b.params.caps.RedundancyPowerNum)}.bind(this))},dowithEncodeCaps:function(){var a=EncodeManager.instance(),b=function(a,b){b.result&&(b.params.caps.PreviewMode&&(this.previewMode=b.params.caps.PreviewMode),b.params.caps.PreviewSplitNumList&&(this.previewSplitNumList=b.params.caps.PreviewSplitNumList),this.audioFrequency.frequency=b.params.caps.AudioFrequence||[],this.audioFrequency.support=0!=this.audioFrequency.frequency.length,isMac||this.mediaEcodeCaps(a,b))};a.getCaps(b.bind(this),!1)},getChCaptureChipCaps:function(){var a=new VideoInput;this.supportMixCapture=[];var b=function(a,b){if(b.result){var c=b.params.caps&&b.params.caps.CaptureChip;if(c)for(var d=0;d<c.length;d++)"1920"==c[d].Width&&"1080"==c[d].Height?this.supportMixCapture.push("HD"):"960"!=c[d].Width||"576"!=c[d].Height&&"480"!=c[d].Height||this.supportMixCapture.push("SD")}}.bind(this);a.instance(0,function(){a.getCapsEx("CaptureChip",b)})},getVideoInputCaps:function(a){void 0==a&&(a=0);var b,c=VideoInput.instance(),d=function(a,b){if(b.result){var c=b.params.caps&&b.params.caps.SignalType;this.singnalType=c,c.contains("AHD")&&(this.supportAHDchn=!0)}}.bind(this);c.instance(a,function(a){b=JSON.decode(a).result,c.getCaps(b,d)})},getDevOutCap:function(){var a=new DevVideoOut,b=1;a.instance(0,function(a,c){c.result&&(b=c.result)},!1),a.getCaps(b,function(a,b){if(b.result){if(this.displayMode=b.params.caps.DisplayPortMode?!0:!1,b.params.caps.AlphaRange){var c=b.params.caps.AlphaRange;this.alphaRange=0==c[0]&&0==c[1]?!1:!0}b.params.caps.Spot&&"Bind"==b.params.caps.Spot.Type&&(this.displaySpotOutMode=!0),this.isTVadjust=b.params.caps.SetMargin||!1}}.bind(this),!1)},getStoragecaps:function(){var a=StorageDev.instance();a.getStorageCpas(function(a,b){if(b.result&&b.params&&b.params.caps){var c=b.params.caps;this.isSupportRaid=c.RAID||!1,"array"===$type(c.SupportDiskCheck)&&c.SupportDiskCheck.contains("Pre")&&c.SupportDiskCheck.contains("Cycle")&&(this.b_supportDiskCheck=!0),this.b_historyCompress=c.CompressOldFile||!1,this.b_realtimeCompress=c.IsRealtimeCompress||!1,this.iscsi.isSupportIscsi=c.RemoteStoreList?c.RemoteStoreList.contains("ISCSI"):!1,c.RedundantDisk&&(this.isRedundant=c.RedundantDisk.Support),c.ISCSI&&$defined(c.ISCSI.Num)&&(this.iscsi.iscsiNum=c.ISCSI.Num)}}.bind(this))},getdiskTank:function(){var a=DiskTank.instance();a.instance(function(a,b){this.isDiskTank=!!b.result}.bind(this))},getOnvifVerison:function(){if(0!=this.REMOTE_CHANNELS){var a=IntervideoClient.instance();a.getVersion("Onvif",function(a,b){if(b.result&&b.params)for(var c=b.params.info||[],d=0;d<c.length;d++)if(c[d]&&c[d].Name&&"Onvif"==c[d].Name){this.onvifVersion=c[d].Version;break}}.bind(this))}},getProductDefinition:function(){var a=new MagicBox,b=this;a.getProductDef(["PlaySnapshot","SearchPrecise","Vendor","AbroadInfo","AccountAccessTime","SupportTimeSetFilter","RemoteRecordChannels","SupportAnalogToDigital","MaxExtendChannels","GB28181","EasySpace"],function(a,c){if(c.result&&"array"===$type(c.params)){var d=c.params;d[0].result&&d[0].params&&d[0].params.definition&&(b.isSupportPlaySnapshot=d[0].params.definition.contains("Web")),d[1].result&&d[1].params&&d[1].params.definition&&(b.b_SearchPrecise=d[1].params.definition.contains("Mouse")&&d[1].params.definition.contains("Second")),d[2].result&&d[2].params&&d[2].params.definition&&(b.productVendor=d[2].params.definition),d[3].result&&d[3].params&&d[3].params.definition&&(b.productAbroadInfo=d[3].params.definition),d[4].result&&d[4].params&&d[4].params.definition&&(b.bUserTimeSet=d[4].params.definition.Schedule||!1),d[5].result&&d[5].params&&d[5].params.definition&&(b.isSupportAdjustTime=d[5].params.definition||!1),b.REMOTE_CHANNELS=d[6].result&&d[6].params&&d[6].params.definition?d[6].params.definition-0:0,d[7].result&&d[7].params&&(b.SupportAnalogToDigital=d[7].params.definition||!1),d[8].result&&d[8].params&&d[8].params.definition&&(b.maxExtendChannels=d[8].params.definition),d[9].result&&d[9].params&&d[9].params.definition&&(b.b_GB28181=d[9].params.definition),d[10].result&&d[10].params&&d[10].params.definition&&(b.g_easySpaceEnable=d[10].params.definition)}},!1)},getNetAppCaps:function(){var a=new NetApp,b=function(a,b){var c=b.params;if(c){var d=c.caps;if(this.isSupportHTTPS=parent.isMac?!1:d.SupportHTTPS,"boolean"==typeof d.DeviceDiscoveryPrivate&&(this.isDeviceDiscoveryPrivate=d.DeviceDiscoveryPrivate),d.SupportNetCardList){var e=d.SupportNetCardList;(e.contains("Manager")||e.contains("Extend"))&&(this.isSupportMultiCardModes=!0)}d.EasySpace&&("boolean"==typeof d.EasySpace?this.g_easySpaceEnable=d.EasySpace:"object"==typeof d.EasySpace&&(this.g_easySpaceEnable=d.EasySpace.length>0))}};a.getCaps(b.bind(this)),a.getNetInterfaces(function(a,b){for(var c=b.params.netInterface,d=0;$chk(c)&&d<c.length&&(!c[d]||(this.PoEEnable=c[d].PoE||!1,!this.PoEEnable));d++);}.bind(this))},getClustercaps:function(){var a=this,b=Cluster.instance();b.getCaps(["DualLive","MasterSlave"],function(b,c){c.result&&c.params&&c.params.info&&("DualLive"===c.params.info.Type?a.isSupportDualLive=!0:"MasterSlave"===c.params.info.Type&&(a.isSupportNM=!0))})},getEventHanderCap:function(){var a=EventManager.instance(),b=this,c=function(a,c){var d=c.params.caps;d&&(d.SupportAlarmBell&&(b.isSupportAlarmBell=d.SupportAlarmBell||!1),d.AlarmOutLatch&&(b.AlarmOutLatch=d.AlarmOutLatch||[1,300]),d.Antidither&&(b.Antidither.support=d.AlarmOutLatch||!1,b.Antidither.range=d.AlarmOutLatch||[0,300]),void 0!=d.SupportAlarmServer&&(b.alarmUpload=d.SupportAlarmServer))};a.getCaps(c)},getMainBoardCount:function(){MagicBox.instance().getMainBoardCount(function(a,b){b.result&&$chk(b.params)&&$defined(b.params.count)&&(this.mainBoardCount=b.params.count)}.bind(this))},getAudioDetectCaps:function(){var a=MediaManage.instance();a.getCaps(["VolumeDetect","AnomalyDetect","MutationDetect"],function(a,b){if(b.result&&b.params.caps){var c=b.params.caps;c&&(this.audioDetect.volumeDetect.support=c.VolumeDetect.Support||!1,this.audioDetect.volumeDetect.channels=c.VolumeDetect.Channels||[],this.audioDetect.anomalyDetect.support=c.AnomalyDetect.Support||!1,this.audioDetect.anomalyDetect.channels=c.AnomalyDetect.Channels||[],this.audioDetect.mutationDetect.support=c.MutationDetect.Support||!1,this.audioDetect.mutationDetect.channels=c.MutationDetect.Channels||[],this.audioDetect.support=this.audioDetect.volumeDetect.support|this.audioDetect.anomalyDetect.support|this.audioDetect.mutationDetect.support)}}.bind(this))},getNotifyVersion:function(){var a=this;new Request.JSON({url:"/RPC2_Notify_Method",secure:!1,onSuccess:function(b){a.notifyVersion=b.NotifyMethod}}).get()},getDeviceAllTypeList:function(){var a=new MagicBox;a.getDeviceClass(function(a){var b=JSON.decode(a);b.result&&(Ability.deviceAllTypeList.g_deviceType=b.params.type)},!1),a.getDeviceType(function(a){var b=JSON.decode(a);b.result&&(Ability.deviceAllTypeList.g_deviceSubType=b.params.type)},!1),"HCVR"===this.deviceAllTypeList.g_deviceType||"HDCVI"===this.deviceAllTypeList.g_deviceType?this.deviceAllTypeList.g_deviceType=this.REMOTE_CHANNELS>0?"HDVR":"DVR":this.deviceAllTypeList.g_deviceSubType.contains("EVS")&&this.deviceAllTypeList.g_deviceType.contains("EVS")&&(this.deviceAllTypeList.g_deviceType="NVR")},getIntellent:function(){var a=VideoAnalyseDevice.instance(0,"devVideoAnalyse");a.getAnalyseCap(0,"devVideoAnalyse",function(a){if(JSON.decode(a).result){var b=JSON.decode(a).params.caps;Ability.g_SupportedScene=b.SupportedScene}},!1)},channelNum:function(){var a=ChannelNumInfo.instance();this.ALARM_IN_NUMBER=a.getAlarmIN(),this.ALARM_OUT_NUMBER=a.getAlarmOUT(),LogicDeviceManager.instance().getVideoInputChannels(function(a,b){b.result&&b.params&&b.params.channelCountInfo&&(this.CHANNEL_NUMBER=b.params.channelCountInfo.CurRemote+b.params.channelCountInfo.CurLocal)}.bind(this),!1)},getRecordCap:function(){var a=this,b=RecordMan.instance();b.getCaps(function(b){JSON.decode(b).result&&(a.maxStreams=JSON.decode(b).params.caps.MaxStreams,a.b_supportRecordMode=JSON.decode(b).params.caps.SupportExtraRecordMode)})}};